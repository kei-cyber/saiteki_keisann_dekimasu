<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¡ä»¶ç”Ÿæˆãƒ„ãƒ¼ãƒ« (155Wãƒ‘ãƒãƒ«ç‰ˆ - ã‚·ãƒ¼ãƒˆè²¼ä»˜ç”¨)</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 22px; }
    
    .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .config-box { background: #f8f9fa; padding: 20px; border-radius: 6px; border: 1px solid #e9ecef; }
    
    label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
    .input-group { margin-bottom: 15px; }
    input[type="number"], input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
    .helper { font-size: 12px; color: #7f8c8d; margin-top: 4px; }
    .unit-label { font-size: 14px; color: #555; background: #e2e6ea; padding: 5px 10px; border-radius: 4px; margin-bottom: 15px; display: inline-block;}

    /* ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    button { width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s; color: white; }
    
    .generate-btn { background: #3498db; margin-bottom: 20px; font-size: 18px; }
    .generate-btn:hover { background: #2980b9; }

    .copy-btn { background: #27ae60; margin-bottom: 10px; }
    .copy-btn:hover { background: #219150; }

    .result-area { margin-top: 20px; display: none; border-top: 2px solid #eee; padding-top: 20px; }
    textarea { width: 100%; height: 200px; font-family: monospace; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 10px; font-size: 14px; }
    
    .status-msg { padding: 15px; margin-bottom: 15px; border-radius: 4px; font-weight: bold; text-align: center; display: none; }
    .error { background-color: #fdecea; color: #e74c3c; border: 1px solid #fadbd8; }
    .success { background-color: #e8f6f3; color: #16a085; border: 1px solid #d4efdf; }

    .toggle-container { display: flex; gap: 10px; margin-bottom: 10px; }
    .mode-btn { flex: 1; padding: 8px; border: 1px solid #bdc3c7; background: #fff; cursor: pointer; text-align: center; border-radius: 4px; font-size: 14px; color: #333; }
    .mode-btn.active { background: #3498db; color: white; border-color: #3498db; }
</style>
</head>
<body>

<div class="container">
    <h1>âš¡ï¸ è¨­å‚™å®¹é‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (155Wãƒ‘ãƒãƒ«ç‰ˆ)</h1>

    <div id="statusMessage" class="status-msg"></div>

    <div class="config-grid">
        <div class="config-box">
            <h2>1. ãƒ‘ãƒãƒ«è¨­å®š</h2>
            <div class="unit-label">ãƒ‘ãƒãƒ«å˜ä½“å‡ºåŠ›: <strong>155 W</strong> (å›ºå®š)</div>
            
            <div class="input-group">
                <label>æšæ•° æœ€å° (Min)</label>
                <input type="number" id="countMin" value="50" placeholder="ä¾‹: 10">
            </div>
            <div class="input-group">
                <label>æšæ•° æœ€å¤§ (Max)</label>
                <input type="number" id="countMax" value="100" placeholder="ä¾‹: 100">
            </div>
            <div class="input-group">
                <label>åˆ»ã¿å¹… (Step)</label>
                <input type="number" id="countStep" value="1" placeholder="ä¾‹: 1">
                <div class="helper">ä¾‹: 1æšãšã¤å¢—ã‚„ã™</div>
            </div>
            <input type="hidden" id="panelUnitWatt" value="155">
        </div>

        <div class="config-box">
            <h2>2. ãƒ‘ãƒ¯ãƒ¼ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒŠ (PCS)</h2>
            <div class="unit-label">PCSå˜ä½“å‡ºåŠ›: <strong>4.95 kW</strong> (å›ºå®š)</div>
            
            <div class="toggle-container">
                <div class="mode-btn active" onclick="setPcsMode('range')" id="btnRange">ç¯„å›²æŒ‡å®š</div>
                <div class="mode-btn" onclick="setPcsMode('fixed')" id="btnFixed">å€‹åˆ¥æŒ‡å®š</div>
            </div>

            <div id="pcsRangeMode">
                <div class="input-group">
                    <label>å°æ•° æœ€å° (å°)</label>
                    <input type="number" id="pcsMinUnits" value="1" min="1">
                    <div class="helper">æœ€å° PCSå®¹é‡: <span id="pcsMinKwDisplay">4.95</span> kW</div>
                </div>
                <div class="input-group">
                    <label>å°æ•° æœ€å¤§ (å°)</label>
                    <input type="number" id="pcsMaxUnits" value="2" min="1">
                    <div class="helper">æœ€å¤§ PCSå®¹é‡: <span id="pcsMaxKwDisplay">9.90</span> kW</div>
                </div>
                <div class="input-group">
                    <label>åˆ»ã¿å¹… (å°)</label>
                    <input type="number" id="pcsStepUnits" value="1" min="1">
                </div>
            </div>

            <div id="pcsFixedMode" style="display:none;">
                <div class="input-group">
                    <label>PCSå°æ•°ãƒªã‚¹ãƒˆ (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</label>
                    <input type="text" id="pcsUnitsList" value="1, 2, 3">
                    <div class="helper">ä¾‹: 1, 2, 3 (å°æ•°ã§æŒ‡å®š)</div>
                </div>
            </div>
        </div>
    </div>

    <div class="config-box" style="margin-bottom: 20px;">
        <h2>3. éç©è¼‰ç‡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (%)</h2>
        <div style="display: flex; gap: 20px;">
            <div style="flex:1;">
                <label>ä¸‹é™ (%)</label>
                <input type="number" id="overloadMin" value="100">
            </div>
            <div style="flex:1;">
                <label>ä¸Šé™ (%)</label>
                <input type="number" id="overloadMax" value="200">
            </div>
        </div>
    </div>

    <button class="generate-btn" onclick="generateCombinations()">çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆã™ã‚‹</button>

    <div id="resultArea" class="result-area">
        <button class="copy-btn" onclick="copyResult()">ğŸ“‹ çµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
        <p class="helper">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®A1ã‚»ãƒ«ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</p>
        <textarea id="outputData" readonly onclick="this.select()"></textarea>
    </div>
</div>

<script>
    const PCS_UNIT_KW = 4.95; // PCS1å°ã‚ãŸã‚Šã®å‡ºåŠ›(kW)
    let pcsMode = 'range';

    function updatePcsDisplay() {
        const minUnits = parseInt(document.getElementById('pcsMinUnits').value) || 1;
        const maxUnits = parseInt(document.getElementById('pcsMaxUnits').value) || 1;
        document.getElementById('pcsMinKwDisplay').innerText = (minUnits * PCS_UNIT_KW).toFixed(2);
        document.getElementById('pcsMaxKwDisplay').innerText = (maxUnits * PCS_UNIT_KW).toFixed(2);
    }

    document.getElementById('pcsMinUnits').addEventListener('input', updatePcsDisplay);
    document.getElementById('pcsMaxUnits').addEventListener('input', updatePcsDisplay);

    function setPcsMode(mode) {
        pcsMode = mode;
        document.getElementById('btnRange').className = mode === 'range' ? 'mode-btn active' : 'mode-btn';
        document.getElementById('btnFixed').className = mode === 'fixed' ? 'mode-btn active' : 'mode-btn';
        document.getElementById('pcsRangeMode').style.display = mode === 'range' ? 'block' : 'none';
        document.getElementById('pcsFixedMode').style.display = mode === 'fixed' ? 'block' : 'none';
    }

    function showStatus(msg, type) {
        const el = document.getElementById('statusMessage');
        el.style.display = 'block';
        el.innerText = msg;
        el.className = 'status-msg ' + type;
    }

    function generateCombinations() {
        document.getElementById('resultArea').style.display = 'none';
        
        const getVal = (id) => parseFloat(document.getElementById(id).value);
        
        const unitW = getVal('panelUnitWatt');
        const cMin = getVal('countMin');
        const cMax = getVal('countMax');
        const cStep = getVal('countStep');
        const ovMin = getVal('overloadMin');
        const ovMax = getVal('overloadMax');

        if (isNaN(cMin) || isNaN(cMax) || isNaN(cStep)) {
            showStatus("ã‚¨ãƒ©ãƒ¼: ãƒ‘ãƒãƒ«æšæ•°ãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", "error");
            return;
        }
        if (cMin > cMax) {
            showStatus("ã‚¨ãƒ©ãƒ¼: æšæ•°ã®æœ€å°å€¤ãŒæœ€å¤§å€¤ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚", "error");
            return;
        }

        let pcsUnits = [];
        if (pcsMode === 'range') {
            const uMin = parseInt(document.getElementById('pcsMinUnits').value);
            const uMax = parseInt(document.getElementById('pcsMaxUnits').value);
            const uStep = parseInt(document.getElementById('pcsStepUnits').value);
            if (isNaN(uMin) || isNaN(uMax) || isNaN(uStep) || uStep <= 0) {
                showStatus("ã‚¨ãƒ©ãƒ¼: PCSå°æ•°è¨­å®šãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚", "error");
                return;
            }
            for (let u = uMin; u <= uMax; u += uStep) {
                pcsUnits.push(u);
            }
        } else {
            const raw = document.getElementById('pcsUnitsList').value;
            if (!raw.trim()) { showStatus("ã‚¨ãƒ©ãƒ¼: PCSå°æ•°ãƒªã‚¹ãƒˆãŒç©ºã§ã™ã€‚", "error"); return; }
            pcsUnits = raw.split(',').map(v => parseInt(v.trim())).filter(v => !isNaN(v) && v > 0);
        }

        let results = [];
        // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ã®ã¿ç”Ÿæˆã—ã¾ã™ã€‚

        let countTried = 0;
        let matchCount = 0;

        for (let count = cMin; count <= cMax; count += cStep) {
            let systemKw = (count * unitW) / 1000;
            
            for (let units of pcsUnits) {
                countTried++;
                let pcsKw = units * PCS_UNIT_KW;
                let overload = (systemKw / pcsKw) * 100;
                
                if (overload >= ovMin && overload <= ovMax) {
                    matchCount++;
                    let sysDisp = Math.round(systemKw * 100) / 100;
                    let pcsDisp = Math.round(pcsKw * 100) / 100;
                    let ovDisp = Math.round(overload * 100) / 100;

                    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”¨: [æšæ•°] [ã‚·ã‚¹ãƒ†ãƒ kW] [PCSå°æ•°] [PCSkW] [éç©è¼‰%]
                    results.push(`${count}\t${sysDisp}\t${units}\t${pcsDisp}\t${ovDisp}`);
                }
            }
        }

        if (matchCount === 0) {
            showStatus(`è¨ˆç®—çµæœ 0ä»¶: ${countTried} é€šã‚Šè©¦ã—ã¾ã—ãŸãŒã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã«åˆè‡´ã—ã¾ã›ã‚“ã§ã—ãŸã€‚`, "error");
        } else {
            showStatus(`å®Œäº†: ${matchCount} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸã€‚`, "success");
            document.getElementById('outputData').value = results.join('\n');
            document.getElementById('resultArea').style.display = 'block';
        }
    }

    function copyResult() {
        const copyText = document.getElementById("outputData");
        copyText.select();
        document.execCommand("copy");
        showStatus("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚", "success");
    }

    updatePcsDisplay();
</script>

</body>
</html>